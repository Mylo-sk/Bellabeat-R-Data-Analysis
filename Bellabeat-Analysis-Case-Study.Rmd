---
title: "Bellabeat data analysis case study"
author: "Samuel Kontor"
date: "2023-05-05"
output:
  html_document:
    df_print: paged
---

## Overview

About the company
Urška Sršen and Sando Mur founded Bellabeat, a high-tech company that manufactures health-focused smart products.
Sršen used her background as an artist to develop beautifully designed technology that informs and inspires women around the world. Collecting data on activity, sleep, stress, and reproductive health has allowed Bellabeat to empower women with
knowledge about their own health and habits. Since it was founded in 2013, Bellabeat has grown rapidly and quickly
positioned itself as a tech-driven wellness company for women.

Scenario
You are a junior data analyst working on the marketing analyst team at Bellabeat, a high-tech manufacturer of health-focused products for women. Bellabeat is a successful small company, but they have the potential to become a larger player in the global smart device market. Urška Sršen, cofounder and Chief Creative Officer of Bellabeat, believes that analyzing smart device fitness data could help unlock new growth opportunities for the company. You have been asked to focus on one of Bellabeat’s products and analyze smart device data to gain insight into how consumers are using their smart devices. The insights you discover will then help guide marketing strategy for the company. You will present your analysis to the Bellabeat executive team along with your high-level recommendations for Bellabeat’s marketing strategy.

## Phase 1: Ask

### Business Task
The business task is for the marketing analytics team at Bellabeat to analyze smart device usage data of one of their products in order to gain insight into how consumers are using their smart devices. This analysis will help guide the marketing strategy for the company and unlock new growth opportunities. 

### Stakeholders
* Urška Sršen: Bellabeat’s cofounder and Chief Creative Officer
* Sando Mur: Mathematician and Bellabeat’s cofounder; key member of the Bellabeat executive team
* Bellabeat marketing analytics team: A team of data analysts responsible for collecting, analyzing, and reporting data that helps guide Bellabeat’s marketing strategy.

## Phase 2: Data Preparation

### Data Source:
* We will be using the data from FitBit Fitness Tracker Data. The data is linked from <https://zenodo.org/record/53894#.X9oeh3Uzaao>.
* The dataset is composed of 18 CSV files organized in long format.
* These datasets were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016.
* 30+ eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.
* Licensing of the data is CC0: Public Domain meaning the owner has allowed this data to become usable by anyone.

### Regarding bias and credibility, both data sources we are utilizing meet the ROCCC criteria: 
* Reliable:The limited sample size of only 30 participants may suggest that the data is not robust enough to support extensive analysis.
* Orignial: This dataset was not originally collected by the requester, but instead was obtained from Amazon Mechanical Turk.
* Comprehensive: The current data set is not inclusive enough as it lacks crucial information about the participants, such as their age, gender, and health status. This could suggest that the data was not collected randomly. If the data is biased towards a specific group of people, then the insights derived from the analysis will not accurately represent all individuals.
* Current: The data was collected in 2016, implying that it may not reflect the current trends in smart device usage and is outdated..
* Cited: As mentioned earlier, the dataset was produced by Amazon Mechanical Turk. However, there is no available information to determine the credibility of this source.

#### Install and load the following packages, as the this comprises of the main packages we will work wiith throughout this whole analysis.
```{r}
library(ggdist)
library(tidyquant)
library(tidyverse)
library(janitor)
library(tidyverse)
library(lubridate)
library(skimr)
library(dplyr)
library(here)
library(readr)
library(corrplot)
library(ggcorrplot)
```

#### Next thing to do is import all your necessary dataset
```{r}
weight_info <- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
daily_activity<- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_sleep<- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
heartrate_seconds <- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/heartrate_seconds_merged.csv")
hourly_steps<- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/hourlySteps_merged.csv")
hourly_intensity<- read_csv("Downloads/Fitabase Data 4.12.16-5.12.16/hourlyIntensities_merged.csv")
```

+ Checking the number and name of column;
```{r}
colnames(weight_info)
head(weight_info)
summary(weight_info)

colnames(daily_activity)
head(daily_activity)
summary(daily_activity)

colnames(daily_sleep)
head(daily_sleep)
summary(daily_sleep)

colnames(heartrate_seconds)
head(heartrate_seconds)
summary(heartrate_seconds)

colnames(hourly_steps)
head(hourly_steps)
summary(hourly_steps)

colnames(hourly_intensity)
head(hourly_intensity)
summary(hourly_intensity)
```

## Phase 3: Data Cleaning

* Verifying number of users.
* Before we continue with our cleaning we want to make sure how many unique users are per data frame.
* Even though 30 is the minimal sample size we will still keep the sleep dataset for practice only.

```{r}
n_distinct(daily_activity$Id)
n_distinct(daily_activity$Id)
n_distinct(daily_sleep$Id)
n_distinct(hourly_steps$Id)
n_distinct(hourly_intensity$Id)
n_distinct(heartrate_seconds$Id)
n_distinct(weight_info$Id)
```

* Removing duplicates
```{r}
sum(duplicated(daily_activity))
sum(duplicated(daily_sleep))
sum(duplicated(weight_info))
sum(duplicated(hourly_intensity))
sum(duplicated(hourly_steps))
sum(duplicated(heartrate_seconds))
```

```{r}
daily_sleep<- distinct(daily_sleep)
sum(duplicated(daily_sleep))
```

* Changing column names and Date and Time format:
```{r}
daily_activity<- rename(daily_activity, "Date" = "ActivityDate")
head(daily_activity)
daily_sleep<- rename(daily_sleep, "Date" = "SleepDay")
head(daily_sleep)

daily_activity$Date<- as.Date(daily_activity$Date, format = "%m/%d/%Y")
head(daily_activity)
daily_sleep$Date<- as.Date(daily_sleep$Date, format = "%m/%d/%Y")
head(daily_sleep)
weight_info$Date<- as.Date(weight_info$Date, format = "%m/%d/%Y")
head(weight_info)
```

* Changing date and time format and separating them in 2 columns:
```{r}
hourly_steps <- hourly_steps %>%
  mutate(ActivityHour = as.POSIXct(ActivityHour, format = "%m/%d/%Y %I:%M:%S %p"))


hourly_steps <- hourly_steps %>%
  mutate(Date = as.Date(ActivityHour),
         Time = format(ActivityHour, "%H:%M:%S"))

hourly_intensity$ActivityHour<- as.POSIXct(hourly_intensity$ActivityHour, format = "%m/%d/%Y %I:%M:%S %p")

hourly_intensity<- hourly_intensity %>%
  mutate(Date = as.Date(ActivityHour),
         Time = format(ActivityHour,  "%H:%M:%S"))

heartrate_seconds<- rename(heartrate_seconds, "ActivityTime" = "Time")
head(heartrate_seconds)
heartrate_seconds$ActivityTime<- as.POSIXct(heartrate_seconds$ActivityTime, format = "%m/%d/%Y %I:%M:%S %p")
heartrate_seconds<- heartrate_seconds %>%
  mutate(Date = as.Date(ActivityTime),
         Time = format(ActivityTime, "%H:%M:%S"))
```

* Checking cleaned datasets:
```{r}
head(daily_activity)
head(daily_sleep)
head(weight_info)
head(hourly_steps)
head(hourly_intensity)
head(heartrate_seconds)
```

* Filter out rows with zero values in Steps and Calories columns from daily_activity
```{r}
daily_activity_clean <- daily_activity %>%
  filter(TotalSteps != 0 & Calories != 0)
```

## Phase 4 & 5: Analyze & Share 

* 1. The daily_sleep dataset will be analyzed to determine the frequency and duration of device usage during sleep.
* 2.  daily_activity dataset will be analyzed to explore the frequency of device usage during the day and to investigate the correlation between steps taken and calories burned.
* 3. The weight_info dataset will be analyzed to determine the frequency of weight measurements taken by users.
* 4. The hourly_steps dataset will be analyzed to investigate the level of activity of users throughout the day.
* 5. The hourly_intensity dataset will be analyzed to determine the type of activity that users engage in.
* 6. The heartrate_seconds dataset will be analyzed to explore users' heart rate patterns over time.

### How frequently and for what duration do people use their devices while sleeping?
  * daily_sleep dataset
```{r}
sleep_days_by_user<- daily_sleep %>%
  group_by(Id) %>%
  summarize(n_dates = n_distinct(Date)) %>%
  mutate(frequency = ifelse(n_dates > 28, "1. Daily usage",
                            ifelse(n_dates > 21, "2. Regular Usage",
                                   ifelse(n_dates > 14, "3. Moderate Usage",
                                          ifelse(n_dates > 7, "4. Occasional usage",
                                                 ifelse(n_dates >= 0, "5. Rare usage"))))))
head(sleep_days_by_user)

```

```{r}
sleep_days_frequency <- sleep_days_by_user %>%
  count(frequency, name = "count") %>%
  mutate(percent = (count / sum(count)) * 100) %>%
  arrange(frequency)
head(sleep_days_frequency)
```

* Creating pie chart with % of users sleeping with device
```{r}
ggplot(data = sleep_days_frequency, aes(x="", y=count, fill=frequency)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0) +
  theme_void() +
  scale_fill_brewer(palette="RdPu") +
  geom_text(aes(label = paste0(round(percent), "%")), position = position_stack(vjust = 0.5)) +
  ggtitle("Usage of Device During Sleep") +
  theme(plot.title = element_text(hjust = 0.5, margin = margin(b = 10)))
```
#### Based on the data provided, it appears that the majority of people (37.5%) use their devices regularly, meaning they use it at least 5 days a week for the full 31-day period. Only 12.5% of people use their devices daily, while 12.5% use it moderately (3-4 days a week), 4.17% use it occasionally (1-2 days a week), and 33.33% use it rarely (less than once a week). From this analysis, we can conclude that people generally do not use their devices while sleeping frequently or for long durations, as the categories of daily and regular usage make up only 50% of the responses. 

NB:
* Daily usage: The device is used every day at least for 28-day period.
* Regular usage: The device is used at least 5 days a week for the full 31-day period.
* Moderate usage: The device is used at least 3-4 days a week for the full 31-day period.
* Occasional usage: The device is used 1-2 days a week for the full 31-day period.
* Rare usage: The device is used less than once a week for the full 31-day period.



### 2. Then we will count how many hours users sleep during a week
* Adding weekday to daily_sleep table:
```{r}
daily_sleep$weekday <- weekdays(daily_sleep$Date)
days <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")
daily_sleep$weekday <- factor(weekdays(daily_sleep$Date), levels = days)
head(daily_sleep)
```

* Creating a barchar for Average sleep duration by weekday
```{r}
ggplot(daily_sleep, aes(x = weekday, y = (TotalMinutesAsleep)/60)) +
  geom_bar(stat = "summary", fun = "mean", fill = "#E46726") +
  geom_hline(yintercept = 8) + 
  labs(x = "", y = "Average Sleep Duration (Hours)", title = "Average Sleep Duration by Weekday")
```
#### Based on the analysis of sleep data, we can observe that on average, users sleep around 7-8 hours per day, which is within the recommended range for adults. However, there is a slight variation in sleep duration across weekdays, with slightly longer sleep on weekends (Saturday and Sunday) compared to weekdays.

* Creating a bar chart of mean sleep time by user:
```{r}
daily_sleep <- daily_sleep %>%
  mutate(Id = dense_rank(Id))
ggplot(daily_sleep, aes(x = Id, y = (TotalMinutesAsleep / 60))) +
  geom_bar(stat = "summary", fun = "mean", fill = "#00CED1") +
  geom_hline(yintercept = 8) +
  labs(x = "User ID", y = "Average Sleep Duration (Hours)", title = "Average Sleep Duration by User")
```
#### The analysis above presents the average sleep duration by user in a bar chart. The chart shows that there is a considerable variation in the average sleep duration across users, with some users consistently sleeping for less than 7 hours a night and others sleeping for more than 8 hours a night. The horizontal line at 8 hours represents the recommended daily sleep duration for adults, as per the National Sleep Foundation. This chart can be used to identify users who may benefit from sleep-related interventions or support.

### 3. How often people use their device during the day?
* Using daily_activity dataset
```{r}
daily_activity_by_user<- daily_activity_clean %>%
  group_by(Id) %>%
  summarize(n_dates = n_distinct(Date)) %>%
  mutate(frequency = ifelse(n_dates > 28, "1. Daily usage",
                            ifelse(n_dates > 21, "2. Regular Usage",
                                   ifelse(n_dates > 14, "3. Moderate Usage",
                                          ifelse(n_dates > 7, "4. Occasional usage",
                                                 ifelse(n_dates >= 0, "5. Rare usage"))))))
head(daily_activity_by_user)
```

```{r}
daily_activity_frequency <- daily_activity_by_user %>%
  count(frequency, name = "count") %>%
  mutate(percent = (count / sum(count)) * 100) %>%
  arrange(frequency)
head(daily_activity_frequency)

```

* Creating a pie chart to see how often users wore their device during the day.
```{r}
ggplot(daily_activity_frequency, aes(x ="", y = count, fill = frequency))+
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0) +
  theme_void() +
  scale_fill_brewer(palette="RdPu") +
  geom_text(aes(label = paste0(round(percent), "%")), position = position_stack(vjust = 0.5)) +
  ggtitle("Usage of Device During Daytime") +
  theme(plot.title = element_text(hjust = 0.5, margin = margin(b = 10)))
```
#### Based on the analysis of daily device usage by users, we found that the majority of users (60.6%) used their devices every day, while 24.2% used them moderately (3-4 days a week) and only 12.1% used them regularly (5 days a week). Interestingly, only 3% of users wore their device less than once a week. These findings suggest that the device is widely used by most users, and it could be an effective tool for promoting healthy behaviors and monitoring physical activity. The pie chart provides a clear visual representation of the usage frequency and can help stakeholders understand how users engage with the device during the daytime. The results of this analysis can be used to understand the extent to which users are committed to tracking their activity and can help in designing personalized interventions for users who do not wear their devices regularly.

* 61% of people use their device often – more than 28 day per month
* 12% of people use their device more than 21 days per month
* 24% of people use their device more than 14 days per month
* Only 3% of people use their device rarely – less than 7 days per month


### 4. How much people and how often measure their weight?
* To calculate this, we will check how many Ids we have in weight table:
```{r}
n_distinct(weight_info$Id)
n_distinct(daily_activity_clean$Id)
```
* so only 8 people measured their weight.
```{r}
(8/33)*100
```
* so Only 24.24% of the users recorderd their weight.

#### To calculate how often users measure their weight and plot a barchart.
```{r}
weight_frequency<- weight_info %>%
  mutate(Id = dense_rank(Id)) %>%
  group_by(Id) %>%
  summarize(n_Dates = n_distinct(Date))

ggplot(weight_frequency, aes(x = Id, y = n_Dates)) +
  geom_bar(stat = "summary", fun = "mean", fill = "#00CED1") +
  labs(x = "User ID", y = "Total Weight Measuring Times", title = "How often Weight was Measured and Recorded")

```
#### Based on our analysis of the weight data, we found that only 24.24% of the users recorded their weight, and only 8 users in total recorded their weight. Among these users, the frequency of measuring weight varied, with an average of 4.13 measurements per user, they measured it on average once every 2 weeks.. This suggests that weight monitoring may not be a priority for many users. However, for those who do measure their weight, they do so on average about 4 times during the period studied. t may be useful to encourage users to record their weight more frequently to obtain more accurate insights into their health and fitness.



### 5. Activity of users during the day
* To calculate activity of users during the day we will create a bar chart to see how many steps users take during the day.
* We will work with hourly_steps data. Preliminary we have change date and time format and separate date and time in different columns.
* Now we will create a bar chart:
```{r}
hourly_steps_frequency<- hourly_steps %>%
  group_by(Time) %>%
  summarize(avg_steps = mean(StepTotal))
head(hourly_steps_frequency)

ggplot(hourly_steps_frequency, aes(x = Time, y = avg_steps))+
  geom_col(aes(fill= avg_steps)) +
  scale_fill_gradient(low = "#FFDAB9", high = "#00CED1") +
  labs(x = "", y = "", title = "Average Steps Recorded per Time of Day")+
  theme(axis.text.x = element_text(angle = 90))
```
#### Based on the analysis of the hourly steps data, we can see that the users are most active during the morning and early afternoon, with the highest average steps recorded between 6:00 AM and 7:00 PM. The peak of user activity is between 5:00 PM and 6:00 PM, with an average of 599.17 steps recorded during this hour. On the other hand, the users are least active during the late night and early morning hours, with the lowest average steps recorded between 3:00 AM and 4:00 AM, with an average of only 6.43 steps recorded during this hour. This information can be valuable to our stakeholders as it can help them better understand the patterns of user activity and use this information to develop targeted interventions or promotions to encourage increased activity during certain times of the day.


### 6. Calculate daily average heart rate and find correlations.
```{r}
daily_heart_rate <- heartrate_seconds %>%
  group_by(Id, Date,) %>%
  summarize(AvgHeartRate = mean(Value))
head(daily_heart_rate)
```
* Adding average heart rate to the daily_activity_clean table
```{r}
daily_activity_full<- daily_activity_clean %>%
  left_join(daily_heart_rate %>%
  select(Id, Date, AvgHeartRate), by = c("Id", "Date"))
head(daily_activity_full)
```

* Joining columns from daily_activity clean to daily_heart_rate to caculate correlation between them;
```{r}
daily_heart_rate_full<- daily_heart_rate %>%
  left_join(daily_activity_clean %>%
              select(Id, Date, TotalSteps, TotalDistance, Calories), by= c("Id","Date"))


head(daily_heart_rate_full)
```
*The number of unique Users who recoreded their heart rate
```{r}
n_distinct(daily_heart_rate$Id)
percent_heartrate_users<- (14/33)*100
head(percent_heartrate_users)
```
* So 14 people had their heart_rate recorded (42.42%) out of 33 people.

#### correlation between Daily steps taken and Calories,  correlation representation of daily steps vs heart rate.
```{r}
cor(daily_activity_full$TotalSteps, daily_activity_full$Calories)
cor(daily_activity_full$TotalSteps, daily_activity_full$TotalDistance)

cor(daily_heart_rate_full$Calories, daily_heart_rate_full$AvgHeartRate, use = "pairwise.complete.obs")
cor(daily_heart_rate_full$TotalSteps, daily_heart_rate_full$AvgHeartRate, use = "pairwise.complete.obs")
cor(daily_heart_rate_full$TotalDistance, daily_heart_rate_full$AvgHeartRate, use = "pairwise.complete.obs")
```

* Plotting a scatter plot to show correlation between Daily steps taken and Calories
```{r}
ggplot(daily_activity_full, aes(x=TotalSteps, y=Calories)) +
  geom_point() +
  geom_smooth(color="#00CED1") + 
  labs(title="Daily Steps vs Calories", x="Daily steps", y="Calories") +
  theme(panel.background = element_blank(), plot.title = element_text(size=12))
```

* correlation matrix representation 
```{r}
cor_matrix_2 <- cor(daily_activity_full[, c("TotalSteps", "Calories")], use = "complete.obs")
ggcorrplot(cor_matrix_2, hc.order = TRUE, type = "lower", 
           colors = c("#6D9EC1", "white", "#E46726"),
           lab = TRUE, lab_size = 6,
           title = "Correlation plot for TotalSteps and Calories")
```


* scatterplot correlation representation of daily steps vs heart rate
```{r}
ggplot(daily_heart_rate_full, aes(x=TotalSteps, y=AvgHeartRate)) +
  geom_point() +
  geom_smooth(color="#00CED1") + 
  labs(title="Daily Steps vs Heart_Rate", x="Daily steps", y="heart_rate") +
  theme(panel.background = element_blank(), plot.title = element_text(size=12))
```

* correlation matrix representation
```{r}
corr_matrix_1 <- cor(daily_heart_rate_full[c("TotalSteps", "AvgHeartRate")], use = "pairwise.complete.obs")
ggcorrplot(corr_matrix_1, type = "upper", colors = c("#6D9EC1", "#FFFFFF", "#E46726"), lab = TRUE, lab_size = 6,
           title = "Correlation plot for TotalSteps and HeartRate")
```
#### In this section, we calculated the daily average heart rate for the users and added it to the daily activity table. We also found that only 14 out of 33 users had recorded their heart rate (42.42%). Next, we calculated the correlations between the daily steps taken, calories burned, distance covered, and heart rate.

#### We found a strong positive correlation between daily steps taken and both calories burned and distance covered. However, the correlation between heart rate and daily steps taken, calories burned, or distance covered was weak. This suggests that heart rate may not be a good indicator of physical activity for these users.

#### We visualized the correlation between daily steps taken and calories burned using a scatter plot, and the correlation matrix was also plotted to show the correlation coefficient between the variables.

#### Finally, we found that the peak correlation was between daily steps taken and distance covered, with a correlation coefficient of 0.982. The lowest correlation was between heart rate and daily steps taken, with a correlation coefficient of 0.184. These results can be presented to stakeholders to provide insights into the relationship between physical activity and heart rate, and to suggest that heart rate may not be the best indicator of activity level for these users.


## Phase 6: Act
### Recommendations

#### Recommendations for how these trends could apply to Bellabeat customers:
* Encourage customers to use their devices regularly to track their activity, sleep, and other health-related metrics.
* Provide personalized recommendations to improve customers' sleep quality based on their sleep patterns, such as suggesting specific sleep schedules or sleep aids.
* Encourage customers to record their weight more frequently to obtain more accurate insights into their health and fitness.
* Encourage customers to be active throughout the day, especially during times when the activity level is low, by providing them with incentives or conducting challenges.
* Provide customers with insights into the relationship between physical activity and heart rate and suggest that heart rate may not be the best indicator of activity level.

### Recommendations for how these trends could help influence Bellabeat marketing strategy:
* Focus on promoting the benefits of being active in the morning, especially between 6 AM and 9 AM, to encourage customers to make physical activity a regular part of their daily routine.
* Promote the use of Bellabeat devices as a way to track and improve sleep quality, and provide personalized recommendations to customers based on their sleep patterns.
* Emphasize the importance of regular weight tracking for improving overall health and fitness, and highlight the features of Bellabeat devices that make weight tracking easy and convenient.
* Create incentives or challenges to encourage customers to be more active throughout the day, especially during times when the activity level is low, and use social media or other platforms to share success stories and motivate customers.
* Use data-driven insights into the relationship between physical activity and heart rate to develop targeted marketing campaigns or promotions that appeal to customers' specific needs and interests.
* Use the information about the correlation between daily steps taken, calories burned, and distance covered to highlight the benefits of physical activity and encourage customers to engage in more physical activity.